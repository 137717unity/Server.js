<% /*! @license ©2013 Ruben Verborgh - Multimedia Lab / iMinds / Ghent University */ -%>
<% inherits('base') %>
<h2>Data source <a href="/<%= datasourceName %>"><em class="datasource"><%= datasourceName %></em></a></h2>

<form action="?" method="GET">
  <fieldset>
    <legend>Triple pattern</legend>
    <ul>
<% ['subject', 'predicate', 'object'].forEach(function (component) { %>
      <li>
        <label for="<%= component %>"><%= component %>:</label>
        <input class="uri" id="<%= component %>" name="<%= component %>"
               value="<%= query[component] || '' %>" />
      </li>
<% }); %>
    </ul>
  </fieldset>
  <p>
    <input type="submit" value="Query" />
  </p>
</form>

<% queryResult -> result %>
<h3>Results for
  <em class="pattern">{
    <%= pattern.subject              ? '<' + pattern.subject   + '>' : '?s' %>
    <%= pattern.predicate            ? '<' + pattern.predicate + '>' : '?p' %>
    <%= N3Util.isUri(pattern.object) ? '<' + pattern.object    + '>' : (pattern.object || '?o') %>
  }</em>
</h3>
<dl>
  <dt class="total">Triples matching this pattern</dt>
  <dd class="total"><%= result.total %></dd>
  <dt class="triples">Triples<%= result.triples.length < result.total ? ' (subset)' : '' %></dt>
  <dd class="triples">
    <ul>
<% result.triples.forEach(function (triple) { %>
      <li class="triple">
  <% ['subject', 'predicate', 'object'].forEach(function (component) {
    var value = triple[component],
        queryValue = /^"/.test(value) ? value : '<' + value + '>';
        short = value.match(/[^\/#]*$/) || value;
  %>
        <a href="?<%= component %>=<%= encodeURIComponent(queryValue) %>"><%
          %><abbr class="<%= component %>" title="<%= value %>"><%= short %></abbr><%
        %></a>
  <% }); %>
      </li>
<% }); %>
    </ul>
  </dd>
</dl>
<% <- %>
