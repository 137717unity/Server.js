<% /*! @license ©2013 Ruben Verborgh - Multimedia Lab / iMinds / Ghent University */ -%>
<h2>Data source <a href="/<%= datasourceName %>"><em class="datasource"><%= datasourceName %></em></a></h2>

<form action="?" method="GET">
  <fieldset>
    <legend>Triple pattern</legend>
    <ul>
<% ['subject', 'predicate', 'object'].forEach(function (component) { -%>
      <li>
        <label for="<%= component %>"><%= component %>:</label>
        <input class="uri" id="<%= component %>" name="<%= component %>" <%
            %> value="<%= query[component] || '' %>" />
      </li>
<% }); -%>
    </ul>
  </fieldset>
  <p>
    <input type="submit" value="Query" />
  </p>
</form>

<% queryResult -> result -%>
<h3>Results for
  <em class="pattern">{<% -%>
    <%= pattern.subject              ? '<' + pattern.subject   + '>' : '?s' -%>
    <%= pattern.predicate            ? '<' + pattern.predicate + '>' : '?p' -%>
    <%= N3Util.isUri(pattern.object) ? '<' + pattern.object    + '>' : (pattern.object || '?o') -%>
  }</em>
</h3>
<dl>
  <dt>Triples matching this pattern</dt>
  <dd property="void:triples" datatype="xsd:integer"><%= result.total %></dd>
  <dt>Triples<%= result.triples.length < result.total ? ' (subset)' : '' %></dt>
  <dd>
    <ul>
  <% result.triples.forEach(function (triple) {
      var subject = triple.subject, predicate = triple.predicate, object = triple.object;
  -%>
      <li class="triple">
        <a href="?subject=%3C<%= encodeURIComponent(subject) %>%3E"><%
          %><abbr title="<%= subject %>"><%= shorten(subject) %></abbr><%
        %></a>
        <a href="?predicate=%3C<%= encodeURIComponent(predicate) %>%3E"><%
          %><abbr title="<%= predicate %>"><%= shorten(predicate) %></abbr><%
        %></a>
        <% if (N3Util.isUri(object)) { -%>
        <a href="?object=%3C<%= encodeURIComponent(object) %>%3E" resource="<%= subject %>"><%
          %><abbr title="<%= object %>" property="<%= predicate %>" resource="<%= object %>"><%=
            shorten(object)
          %></abbr></a>
        <% } else {
          var type = N3Util.getLiteralType(object),
              language = N3Util.getLiteralLanguage(object);
        -%>
        <a href="?object=<%= encodeURIComponent(object) %>" resource="<%= subject %>"><%
          %>"<span property="<%= predicate %>" <%
                  if (!language) { %>datatype="<%= type %>"<% }
                  else { %>lang="<%= language %>" xml:lang="<%= language %>"<% } %>><%=
            N3Util.getLiteralValue(object)
          %></span>"</a>
        <% } %>
      </li>
<% }); -%>
    </ul>
  </dd>
</dl>
<% <- -%>
<%
function shorten(entity) {
  return entity.match(/([^\/#]*)[\/#]?$/)[1] || entity;
}
-%>
