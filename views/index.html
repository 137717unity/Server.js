<% /*! @license Â©2013 Ruben Verborgh - Multimedia Lab / iMinds / Ghent University */ -%>
<% inherits('base') %>
<%
var rdf  = 'http://www.w3.org/1999/02/22-rdf-syntax-ns#',
    rdfs = 'http://www.w3.org/2000/01/rdf-schema#',
    dc   = 'http://purl.org/dc/terms/',
    voID = 'http://rdfs.org/ns/void#';
%>

<% var hasQuery = Object.keys(query).length > 0; %>
<% if (!hasQuery) { %>
<div class="index">
  <h2>Available datasets</h2>
  <p>This Linked Data Fragments server offers the following datasets:</p>
  <%
    var datasets = {};
    triples.forEach(function (triple) {
      var id = triple.subject.match(/[\-a-z_]+$/i)[0],
          dataset = datasets[id] || (datasets[id] = {});
      dataset[triple.predicate] = triple.object;
    });
    var ids = Object.keys(datasets).filter(
      function (id) { return datasets[id][rdf + 'type'] === voID + 'Dataset'; });
  %>
  <dl class="datasets">
    <% ids.forEach(function (id) {
        var dataset = datasets[id]; %>
        <dt><a href="<%= id %>"><%= decode(dataset[rdfs + 'label']) %></a></dt>
        <dd><%= decode(dataset[dc + 'description']) || 'Â ' %></dd>
    <% }) %>
  </dl>
  <p>The current dataset <em class="dataset">index</em> contains metadata about these datasets.</p>
</div>
<% } %>

<%
  function decode(literal) {
    return literal ? literal.match(/^"(.+)"/)[1] : '';
  }
%>

<%- render('fragment') %>
